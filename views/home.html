<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grow A Garden â€” Home</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .nav-tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .nav-tabs button {
      background: #2e8a46;
      border: 0;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }
  </style>
</head>

<body>
  <div class="container" style="display:block; max-width:950px;">

    <header class="brand" style="flex-direction:row; justify-content:space-between;">
      <div>
        <h1>Grow A Garden</h1>
        <p>Welcome back to your garden!</p>
      </div>

      <nav>
        <a href="/profile" class="primary">Profile</a>
        <a href="/logout" class="secondary">Logout</a>
      </nav>
    </header>

    <!-- TABS -->
    <div class="nav-tabs">
      <button onclick="switchTab('knowledge')">General Knowledge</button>
      <button onclick="switchTab('region')">Plants in Your Region</button>
      <button onclick="switchTab('lookup')">Plant Lookup</button>
      <button onclick="switchTab('saved')">Your Plants</button>
    </div>

    <!-- GENERAL KNOWLEDGE -->
    <section id="knowledge" class="tab-panel active card">
      <h2>General Plant Knowledge</h2>
      <p class="helper">Learn basic gardening categories.</p>

      <ul>
        <li><b>Flowers:</b> Tulips, Roses, Daisies, Sunflowers</li>
        <li><b>Vegetables:</b> Tomatoes, Lettuce, Peppers, Cucumbers</li>
        <li><b>Fruits:</b> Strawberries, Blueberries, Peaches, Apples</li>
      </ul>
    </section>

    <!-- REGION SUGGESTIONS -->
    <section id="region" class="tab-panel card">
      <h2>Plants Recommended For Your Region</h2>
      <p class="helper">Fetching your location...</p>

      <div id="regionResults"></div>
    </section>

    <!-- PLANT LOOKUP -->
    <section id="lookup" class="tab-panel card">
      <h2>Plant Lookup</h2>
      <input id="lookupInput" type="text" placeholder="Search any plant..." style="padding:0.7rem; width:100%;" />

      <button class="primary" onclick="searchPlant()">Search</button>

      <div id="lookupResults"></div>
    </section>

    <!-- SAVED PLANTS -->
    <section id="saved" class="tab-panel card">
      <h2>Your Saved Plants</h2>
      <div id="savedContainer"></div>
    </section>

  </div>

  <script>
    function switchTab(tabName) {
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove("active"));
      document.getElementById(tabName).classList.add("active");
    }

    // REGION SUGGESTIONS
    function loadRegionPlants() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const { latitude, longitude } = pos.coords;

          fetch(`/plants/region?lat=${latitude}&lon=${longitude}`)
            .then(res => res.json())
            .then(data => {
              const box = document.getElementById("regionResults");
              box.innerHTML = data?.data
                ? data.data.map(p => `<p><b>${p.common_name}</b></p>`).join("")
                : "No data";
            });
        });
      }
    }

    // LOOKUP SEARCH
    function searchPlant() {
      const name = document.getElementById("lookupInput").value;
      fetch(`/plants/search?q=${name}`)
        .then(res => res.json())
        .then(data => {
          const box = document.getElementById("lookupResults");
          box.innerHTML = data?.data
            ? data.data.map(p => `<p><b>${p.common_name}</b></p>`).join("")
            : "No results found.";
        });
    }

    // Load region + saved plants on page load
    loadRegionPlants();
  </script>

</body>

</html>
