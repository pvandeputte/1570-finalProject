<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grow A Garden â€” Home</title>

  <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
  <div class="container" style="display:block; max-width:1050px;">

    <header class="brand" style="flex-direction:row; justify-content:space-between;">
      <div>
        <h1>Grow A Garden</h1>
        <p>Your personal gardening hub ðŸŒ±</p>
      </div>

      <nav>
        <a href="/profile" class="primary">Profile</a>
        <a href="/logout" class="secondary">Logout</a>
      </nav>
    </header>

    <div class="nav-tabs">
      <button onclick="switchTab('knowledge')">General Knowledge</button>
      <button onclick="switchTab('region')">Plants In Your Region</button>
      <button onclick="switchTab('lookup')">Plant Lookup</button>
      <button onclick="switchTab('saved')">Your Saved Plants</button>
    </div>

    <!-- KNOWLEDGE TAB -->
    <section id="knowledge" class="tab-panel active card">
      <h2>General Plant Knowledge</h2>
      <p class="helper">Learn basic gardening categories and what grows well.</p>

      <ul>
        <li><b>Flowers:</b> Tulips, Roses, Daisies, Sunflowers</li>
        <li><b>Vegetables:</b> Tomatoes, Lettuce, Peppers, Cucumbers</li>
        <li><b>Fruits:</b> Strawberries, Blueberries, Peaches, Apples</li>
        <li><b>Herbs:</b> Basil, Mint, Rosemary, Thyme</li>
      </ul>
    </section>

    <!-- REGION TAB -->
    <section id="region" class="tab-panel card">
      <h2>Plants Recommended For Your Region</h2>
      <p class="helper">Finding plants based on your location...</p>
      <div id="regionResults"></div>
    </section>

    <!-- LOOKUP TAB -->
    <section id="lookup" class="tab-panel card">
      <h2>Plant Lookup</h2>
      <p class="helper">Find details about any plant using the Perenual API.</p>

      <input id="lookupInput" type="text" placeholder="Search any plant..." style="padding:0.8rem; width:100%; border-radius:10px;" />
      <button class="primary" onclick="searchPlant()" style="margin-top:0.6rem;">Search</button>

      <div id="lookupResults"></div>
    </section>

    <!-- SAVED TAB -->
    <section id="saved" class="tab-panel card">
      <h2>Your Saved Plants</h2>
      <p class="helper">Here are plants youâ€™ve saved for your garden plan.</p>
      <div id="savedContainer"></div>
    </section>

  </div>


  <script>
    function switchTab(tabName) {
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove("active"));
      document.getElementById(tabName).classList.add("active");

      if (tabName === "saved") loadSavedPlants();
      if (tabName === "region") loadRegionPlants();
    }

    // SEARCH
    function searchPlant() {
      const q = document.getElementById("lookupInput").value.trim();
      if (!q) return;

      fetch(`/plants/search?q=${q}`)
        .then(res => res.json())
        .then(plants => {
          const box = document.getElementById("lookupResults");
          box.innerHTML = "";

          plants.forEach(p => {
            box.innerHTML += `
              <div class="lookup-entry">
                <h3>${p.common_name}</h3>
                <p><b>Scientific:</b> ${p.scientific_name}</p>
                <img src="${p.image}" width="160">

                <button class="primary" onclick='savePlant(${JSON.stringify(p)})'>
                  Save Plant
                </button>
              </div>
            `;
          });
        });
    }

    // SAVE
    function savePlant(plantObj) {
      fetch("/plants/save", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(plantObj)
      })
        .then(res => res.json())
        .then(() => loadSavedPlants());
    }

    // SAVED
    function loadSavedPlants() {
      fetch("/plants/saved")
        .then(res => res.json())
        .then(plants => {
          const box = document.getElementById("savedContainer");
          box.innerHTML = "";

          plants.forEach(p => {
            box.innerHTML += `
              <div class="plant-card">
                <img src="${p.image}" width="160">
                <h3>${p.common_name}</h3>
                <p><b>Scientific:</b> ${p.scientific_name}</p>
                <p><b>Sunlight:</b> ${p.sunlight.join(", ")}</p>
                <p><b>Watering:</b> ${p.watering}</p>

                <button onclick="deletePlant('${p._id}')" class="secondary">
                  Delete
                </button>
              </div>
            `;
          });
        });
    }

    // DELETE
    function deletePlant(id) {
      fetch(`/plants/${id}`, { method: "DELETE" })
        .then(() => loadSavedPlants());
    }

    // REGION
    function loadRegionPlants() {
      navigator.geolocation.getCurrentPosition(pos => {
        const { latitude, longitude } = pos.coords;

        fetch(`/plants/region?lat=${latitude}&lon=${longitude}`)
          .then(res => res.json())
          .then(plants => {
            const box = document.getElementById("regionResults");
            box.innerHTML = "";

            plants.forEach(p => {
              box.innerHTML += `
                <div class="lookup-entry">
                  <h3>${p.common_name}</h3>
                  <p>${p.scientific_name}</p>
                  <img src="${p.image}" width="160">
                </div>
              `;
            });
          });
      });
    }

    loadSavedPlants();
    loadRegionPlants();
  </script>

</body>

</html>
